# patterns

# The following elements are available for operand expansion:
#
#    left               register assigned to parameter 1
#    left_int1          from parameter 1 triple
#    right              register assigned to parameter 2
#    right_int1         from parameter 2 triple
#    ans                register assigned to output
#    int1               from triple
#    int2               from triple
#    string             from triple
#    next_conditional   from block

+: int 0-63=delink, any=2*immed_word output
    ADIW  {right}, {left_int1}

+: any=2*immed_word output, int 0-63=delink
    ADIW  {left}, {right_int1}

+: int=delink, any=2*immed output
    SUBI  lo_reg({right}), lo8(-{left_int1})
    SBCI  hi_reg({right}), hi8(-{left_int1})

+: any=2*immed output, int=delink
    SUBI  lo_reg({left}), lo8(-{right_int1})
    SBCI  hi_reg({left}), hi8(-{right_int1})

+: last_use any=2*single output, any=2*single
    ADD  lo_reg({left}), lo_reg({right})
    ADC  hi_reg({left}), hi_reg({right})

+: reused=2*single, last_use=2*single output
    ADD  lo_reg({right}), lo_reg({left})
    ADC  hi_reg({right}), hi_reg({left})

+: reused=2*single, reused=2*single output
    ADD  lo_reg({right}), lo_reg({left})
    ADC  hi_reg({right}), hi_reg({left})

-: any=2*immed_word output, int 0-63=delink
    SBIW  {left}, {right_int1}

-: any=2*immed output, int=delink
    SUBI  lo_reg({left}), lo8({right_int1})
    SBCI  hi_reg({left}), hi8({right_int1})

-: any=2*single output, any=2*single
    SUB  lo_reg({left}), lo_reg({right})
    SBC  hi_reg({left}), hi_reg({right})

int: ans=2*single
    LDI  lo_reg({ans}), lo8({int1})
    LDI  hi_reg({ans}), hi8({int1})

#local
#    get_local

output-bit-set
    SBI  io.{string}, {int1}

#if-true: last_use
#    OR   lo_reg({left}), hi_reg({left})
#    jeq  {next_conditional}

if-true: any=2*single
    OR   lo_reg({left}), lo_reg({left})
    CPC  lo_reg({left}), hi_reg({left})
    BRNE {next_conditional}

